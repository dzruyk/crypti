#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <endian.h>

#include "whirlpool.h"

/* 
 * LE32 and LE64 macroses turn 32-bit and 64-bit constant values
 * to little-endian byte order. Whirlpool tables are constructed 
 * with LE byte order in mind.
 */

#if __BYTE_ORDER == __LITTLE_ENDIAN
#define LE32(x)	(x)
#define LE64(x)	(x)
#elif __BYTE_ORDER == __BIG_ENDIAN
#define LE32(x)	\
	(((x) << 24) | (((x) & 0xff00) << 8) | \
	 ((x) >> 24) | (((x) & 0xff0000) >> 8))
#define LE64(x) \
	(((x) << 56) | (((x) & 0xff00) << 40) | \
	 (((x) & 0xff0000) << 24) | (((x) & 0xff000000) << 8) | \
	 (((x) & 0xff00000000ULL) >> 8) | (((x) & 0xff0000000000ULL) >> 24) | \
	 (((x) & 0xff000000000000ULL) >> 40) | ((x) >> 56))
#else
#error unknown byte order!
#endif

/* 64-bit word swap LO and HI parts */
#define R64(x)	((x >> 32) | (x << 32))

/* 64-bit word rotate left */
#define ROL64(x, n)	((((uint64_t)(x)) << (n)) | (((uint64_t)(x)) >> (64-(n))))

const uint64_t W0[] = {
	LE64(0x0000000000000000LLU), LE64(0x0902050801040101ULL), LE64(0x12040a1002080202ULL), LE64(0x1b060f18030c0303ULL),
	LE64(0x2408142004100404ULL), LE64(0x2d0a112805140505ULL), LE64(0x360c1e3006180606ULL), LE64(0x3f0e1b38071c0707ULL),
	LE64(0x4810284008200808ULL), LE64(0x41122d4809240909ULL), LE64(0x5a1422500a280a0aULL), LE64(0x531627580b2c0b0bULL),
	LE64(0x6c183c600c300c0cULL), LE64(0x651a39680d340d0dULL), LE64(0x7e1c36700e380e0eULL), LE64(0x771e33780f3c0f0fULL),
	LE64(0x9020508010401010ULL), LE64(0x9922558811441111ULL), LE64(0x82245a9012481212ULL), LE64(0x8b265f98134c1313ULL),
	LE64(0xb42844a014501414ULL), LE64(0xbd2a41a815541515ULL), LE64(0xa62c4eb016581616ULL), LE64(0xaf2e4bb8175c1717ULL),
	LE64(0xd83078c018601818ULL), LE64(0xd1327dc819641919ULL), LE64(0xca3472d01a681a1aULL), LE64(0xc33677d81b6c1b1bULL),
	LE64(0xfc386ce01c701c1cULL), LE64(0xf53a69e81d741d1dULL), LE64(0xee3c66f01e781e1eULL), LE64(0xe73e63f81f7c1f1fULL),
	LE64(0x3d40a01d20802020ULL), LE64(0x3442a51521842121ULL), LE64(0x2f44aa0d22882222ULL), LE64(0x2646af05238c2323ULL),
	LE64(0x1948b43d24902424ULL), LE64(0x104ab13525942525ULL), LE64(0x0b4cbe2d26982626ULL), LE64(0x024ebb25279c2727ULL),
	LE64(0x7550885d28a02828ULL), LE64(0x7c528d5529a42929ULL), LE64(0x6754824d2aa82a2aULL), LE64(0x6e5687452bac2b2bULL),
	LE64(0x51589c7d2cb02c2cULL), LE64(0x585a99752db42d2dULL), LE64(0x435c966d2eb82e2eULL), LE64(0x4a5e93652fbc2f2fULL),
	LE64(0xad60f09d30c03030ULL), LE64(0xa462f59531c43131ULL), LE64(0xbf64fa8d32c83232ULL), LE64(0xb666ff8533cc3333ULL),
	LE64(0x8968e4bd34d03434ULL), LE64(0x806ae1b535d43535ULL), LE64(0x9b6ceead36d83636ULL), LE64(0x926eeba537dc3737ULL),
	LE64(0xe570d8dd38e03838ULL), LE64(0xec72ddd539e43939ULL), LE64(0xf774d2cd3ae83a3aULL), LE64(0xfe76d7c53bec3b3bULL),
	LE64(0xc178ccfd3cf03c3cULL), LE64(0xc87ac9f53df43d3dULL), LE64(0xd37cc6ed3ef83e3eULL), LE64(0xda7ec3e53ffc3f3fULL),
	LE64(0x7a805d3a401d4040ULL), LE64(0x7382583241194141ULL), LE64(0x6884572a42154242ULL), LE64(0x6186522243114343ULL),
	LE64(0x5e88491a440d4444ULL), LE64(0x578a4c1245094545ULL), LE64(0x4c8c430a46054646ULL), LE64(0x458e460247014747ULL),
	LE64(0x3290757a483d4848ULL), LE64(0x3b92707249394949ULL), LE64(0x20947f6a4a354a4aULL), LE64(0x29967a624b314b4bULL),
	LE64(0x1698615a4c2d4c4cULL), LE64(0x1f9a64524d294d4dULL), LE64(0x049c6b4a4e254e4eULL), LE64(0x0d9e6e424f214f4fULL),
	LE64(0xeaa00dba505d5050ULL), LE64(0xe3a208b251595151ULL), LE64(0xf8a407aa52555252ULL), LE64(0xf1a602a253515353ULL),
	LE64(0xcea8199a544d5454ULL), LE64(0xc7aa1c9255495555ULL), LE64(0xdcac138a56455656ULL), LE64(0xd5ae168257415757ULL),
	LE64(0xa2b025fa587d5858ULL), LE64(0xabb220f259795959ULL), LE64(0xb0b42fea5a755a5aULL), LE64(0xb9b62ae25b715b5bULL),
	LE64(0x86b831da5c6d5c5cULL), LE64(0x8fba34d25d695d5dULL), LE64(0x94bc3bca5e655e5eULL), LE64(0x9dbe3ec25f615f5fULL),
	LE64(0x47c0fd27609d6060ULL), LE64(0x4ec2f82f61996161ULL), LE64(0x55c4f73762956262ULL), LE64(0x5cc6f23f63916363ULL),
	LE64(0x63c8e907648d6464ULL), LE64(0x6acaec0f65896565ULL), LE64(0x71cce31766856666ULL), LE64(0x78cee61f67816767ULL),
	LE64(0x0fd0d56768bd6868ULL), LE64(0x06d2d06f69b96969ULL), LE64(0x1dd4df776ab56a6aULL), LE64(0x14d6da7f6bb16b6bULL),
	LE64(0x2bd8c1476cad6c6cULL), LE64(0x22dac44f6da96d6dULL), LE64(0x39dccb576ea56e6eULL), LE64(0x30dece5f6fa16f6fULL),
	LE64(0xd7e0ada770dd7070ULL), LE64(0xdee2a8af71d97171ULL), LE64(0xc5e4a7b772d57272ULL), LE64(0xcce6a2bf73d17373ULL),
	LE64(0xf3e8b98774cd7474ULL), LE64(0xfaeabc8f75c97575ULL), LE64(0xe1ecb39776c57676ULL), LE64(0xe8eeb69f77c17777ULL),
	LE64(0x9ff085e778fd7878ULL), LE64(0x96f280ef79f97979ULL), LE64(0x8df48ff77af57a7aULL), LE64(0x84f68aff7bf17b7bULL),
	LE64(0xbbf891c77ced7c7cULL), LE64(0xb2fa94cf7de97d7dULL), LE64(0xa9fc9bd77ee57e7eULL), LE64(0xa0fe9edf7fe17f7fULL),
	LE64(0xf41dba74803a8080ULL), LE64(0xfd1fbf7c813e8181ULL), LE64(0xe619b06482328282ULL), LE64(0xef1bb56c83368383ULL),
	LE64(0xd015ae54842a8484ULL), LE64(0xd917ab5c852e8585ULL), LE64(0xc211a44486228686ULL), LE64(0xcb13a14c87268787ULL),
	LE64(0xbc0d9234881a8888ULL), LE64(0xb50f973c891e8989ULL), LE64(0xae0998248a128a8aULL), LE64(0xa70b9d2c8b168b8bULL),
	LE64(0x980586148c0a8c8cULL), LE64(0x9107831c8d0e8d8dULL), LE64(0x8a018c048e028e8eULL), LE64(0x8303890c8f068f8fULL),
	LE64(0x643deaf4907a9090ULL), LE64(0x6d3feffc917e9191ULL), LE64(0x7639e0e492729292ULL), LE64(0x7f3be5ec93769393ULL),
	LE64(0x4035fed4946a9494ULL), LE64(0x4937fbdc956e9595ULL), LE64(0x5231f4c496629696ULL), LE64(0x5b33f1cc97669797ULL),
	LE64(0x2c2dc2b4985a9898ULL), LE64(0x252fc7bc995e9999ULL), LE64(0x3e29c8a49a529a9aULL), LE64(0x372bcdac9b569b9bULL),
	LE64(0x0825d6949c4a9c9cULL), LE64(0x0127d39c9d4e9d9dULL), LE64(0x1a21dc849e429e9eULL), LE64(0x1323d98c9f469f9fULL),
	LE64(0xc95d1a69a0baa0a0ULL), LE64(0xc05f1f61a1bea1a1ULL), LE64(0xdb591079a2b2a2a2ULL), LE64(0xd25b1571a3b6a3a3ULL),
	LE64(0xed550e49a4aaa4a4ULL), LE64(0xe4570b41a5aea5a5ULL), LE64(0xff510459a6a2a6a6ULL), LE64(0xf6530151a7a6a7a7ULL),
	LE64(0x814d3229a89aa8a8ULL), LE64(0x884f3721a99ea9a9ULL), LE64(0x93493839aa92aaaaULL), LE64(0x9a4b3d31ab96ababULL),
	LE64(0xa5452609ac8aacacULL), LE64(0xac472301ad8eadadULL), LE64(0xb7412c19ae82aeaeULL), LE64(0xbe432911af86afafULL),
	LE64(0x597d4ae9b0fab0b0ULL), LE64(0x507f4fe1b1feb1b1ULL), LE64(0x4b7940f9b2f2b2b2ULL), LE64(0x427b45f1b3f6b3b3ULL),
	LE64(0x7d755ec9b4eab4b4ULL), LE64(0x74775bc1b5eeb5b5ULL), LE64(0x6f7154d9b6e2b6b6ULL), LE64(0x667351d1b7e6b7b7ULL),
	LE64(0x116d62a9b8dab8b8ULL), LE64(0x186f67a1b9deb9b9ULL), LE64(0x036968b9bad2babaULL), LE64(0x0a6b6db1bbd6bbbbULL),
	LE64(0x35657689bccabcbcULL), LE64(0x3c677381bdcebdbdULL), LE64(0x27617c99bec2bebeULL), LE64(0x2e637991bfc6bfbfULL),
	LE64(0x8e9de74ec027c0c0ULL), LE64(0x879fe246c123c1c1ULL), LE64(0x9c99ed5ec22fc2c2ULL), LE64(0x959be856c32bc3c3ULL),
	LE64(0xaa95f36ec437c4c4ULL), LE64(0xa397f666c533c5c5ULL), LE64(0xb891f97ec63fc6c6ULL), LE64(0xb193fc76c73bc7c7ULL),
	LE64(0xc68dcf0ec807c8c8ULL), LE64(0xcf8fca06c903c9c9ULL), LE64(0xd489c51eca0fcacaULL), LE64(0xdd8bc016cb0bcbcbULL),
	LE64(0xe285db2ecc17ccccULL), LE64(0xeb87de26cd13cdcdULL), LE64(0xf081d13ece1fceceULL), LE64(0xf983d436cf1bcfcfULL),
	LE64(0x1ebdb7ced067d0d0ULL), LE64(0x17bfb2c6d163d1d1ULL), LE64(0x0cb9bdded26fd2d2ULL), LE64(0x05bbb8d6d36bd3d3ULL),
	LE64(0x3ab5a3eed477d4d4ULL), LE64(0x33b7a6e6d573d5d5ULL), LE64(0x28b1a9fed67fd6d6ULL), LE64(0x21b3acf6d77bd7d7ULL),
	LE64(0x56ad9f8ed847d8d8ULL), LE64(0x5faf9a86d943d9d9ULL), LE64(0x44a9959eda4fdadaULL), LE64(0x4dab9096db4bdbdbULL),
	LE64(0x72a58baedc57dcdcULL), LE64(0x7ba78ea6dd53ddddULL), LE64(0x60a181bede5fdedeULL), LE64(0x69a384b6df5bdfdfULL),
	LE64(0xb3dd4753e0a7e0e0ULL), LE64(0xbadf425be1a3e1e1ULL), LE64(0xa1d94d43e2afe2e2ULL), LE64(0xa8db484be3abe3e3ULL),
	LE64(0x97d55373e4b7e4e4ULL), LE64(0x9ed7567be5b3e5e5ULL), LE64(0x85d15963e6bfe6e6ULL), LE64(0x8cd35c6be7bbe7e7ULL),
	LE64(0xfbcd6f13e887e8e8ULL), LE64(0xf2cf6a1be983e9e9ULL), LE64(0xe9c96503ea8feaeaULL), LE64(0xe0cb600beb8bebebULL),
	LE64(0xdfc57b33ec97ececULL), LE64(0xd6c77e3bed93ededULL), LE64(0xcdc17123ee9feeeeULL), LE64(0xc4c3742bef9befefULL),
	LE64(0x23fd17d3f0e7f0f0ULL), LE64(0x2aff12dbf1e3f1f1ULL), LE64(0x31f91dc3f2eff2f2ULL), LE64(0x38fb18cbf3ebf3f3ULL),
	LE64(0x07f503f3f4f7f4f4ULL), LE64(0x0ef706fbf5f3f5f5ULL), LE64(0x15f109e3f6fff6f6ULL), LE64(0x1cf30cebf7fbf7f7ULL),
	LE64(0x6bed3f93f8c7f8f8ULL), LE64(0x62ef3a9bf9c3f9f9ULL), LE64(0x79e93583facffafaULL), LE64(0x70eb308bfbcbfbfbULL),
	LE64(0x4fe52bb3fcd7fcfcULL), LE64(0x46e72ebbfdd3fdfdULL), LE64(0x5de121a3fedffefeULL), LE64(0x54e324abffdbffffULL)
};
const uint64_t W1[] = {
	LE64(0x0000000000000000ULL), LE64(0x0205080104010109ULL), LE64(0x040a100208020212ULL), LE64(0x060f18030c03031bULL),
	LE64(0x0814200410040424ULL), LE64(0x0a1128051405052dULL), LE64(0x0c1e300618060636ULL), LE64(0x0e1b38071c07073fULL),
	LE64(0x1028400820080848ULL), LE64(0x122d480924090941ULL), LE64(0x1422500a280a0a5aULL), LE64(0x1627580b2c0b0b53ULL),
	LE64(0x183c600c300c0c6cULL), LE64(0x1a39680d340d0d65ULL), LE64(0x1c36700e380e0e7eULL), LE64(0x1e33780f3c0f0f77ULL),
	LE64(0x2050801040101090ULL), LE64(0x2255881144111199ULL), LE64(0x245a901248121282ULL), LE64(0x265f98134c13138bULL),
	LE64(0x2844a014501414b4ULL), LE64(0x2a41a815541515bdULL), LE64(0x2c4eb016581616a6ULL), LE64(0x2e4bb8175c1717afULL),
	LE64(0x3078c018601818d8ULL), LE64(0x327dc819641919d1ULL), LE64(0x3472d01a681a1acaULL), LE64(0x3677d81b6c1b1bc3ULL),
	LE64(0x386ce01c701c1cfcULL), LE64(0x3a69e81d741d1df5ULL), LE64(0x3c66f01e781e1eeeULL), LE64(0x3e63f81f7c1f1fe7ULL),
	LE64(0x40a01d208020203dULL), LE64(0x42a5152184212134ULL), LE64(0x44aa0d228822222fULL), LE64(0x46af05238c232326ULL),
	LE64(0x48b43d2490242419ULL), LE64(0x4ab1352594252510ULL), LE64(0x4cbe2d269826260bULL), LE64(0x4ebb25279c272702ULL),
	LE64(0x50885d28a0282875ULL), LE64(0x528d5529a429297cULL), LE64(0x54824d2aa82a2a67ULL), LE64(0x5687452bac2b2b6eULL),
	LE64(0x589c7d2cb02c2c51ULL), LE64(0x5a99752db42d2d58ULL), LE64(0x5c966d2eb82e2e43ULL), LE64(0x5e93652fbc2f2f4aULL),
	LE64(0x60f09d30c03030adULL), LE64(0x62f59531c43131a4ULL), LE64(0x64fa8d32c83232bfULL), LE64(0x66ff8533cc3333b6ULL),
	LE64(0x68e4bd34d0343489ULL), LE64(0x6ae1b535d4353580ULL), LE64(0x6ceead36d836369bULL), LE64(0x6eeba537dc373792ULL),
	LE64(0x70d8dd38e03838e5ULL), LE64(0x72ddd539e43939ecULL), LE64(0x74d2cd3ae83a3af7ULL), LE64(0x76d7c53bec3b3bfeULL),
	LE64(0x78ccfd3cf03c3cc1ULL), LE64(0x7ac9f53df43d3dc8ULL), LE64(0x7cc6ed3ef83e3ed3ULL), LE64(0x7ec3e53ffc3f3fdaULL),
	LE64(0x805d3a401d40407aULL), LE64(0x8258324119414173ULL), LE64(0x84572a4215424268ULL), LE64(0x8652224311434361ULL),
	LE64(0x88491a440d44445eULL), LE64(0x8a4c124509454557ULL), LE64(0x8c430a460546464cULL), LE64(0x8e46024701474745ULL),
	LE64(0x90757a483d484832ULL), LE64(0x927072493949493bULL), LE64(0x947f6a4a354a4a20ULL), LE64(0x967a624b314b4b29ULL),
	LE64(0x98615a4c2d4c4c16ULL), LE64(0x9a64524d294d4d1fULL), LE64(0x9c6b4a4e254e4e04ULL), LE64(0x9e6e424f214f4f0dULL),
	LE64(0xa00dba505d5050eaULL), LE64(0xa208b251595151e3ULL), LE64(0xa407aa52555252f8ULL), LE64(0xa602a253515353f1ULL),
	LE64(0xa8199a544d5454ceULL), LE64(0xaa1c9255495555c7ULL), LE64(0xac138a56455656dcULL), LE64(0xae168257415757d5ULL),
	LE64(0xb025fa587d5858a2ULL), LE64(0xb220f259795959abULL), LE64(0xb42fea5a755a5ab0ULL), LE64(0xb62ae25b715b5bb9ULL),
	LE64(0xb831da5c6d5c5c86ULL), LE64(0xba34d25d695d5d8fULL), LE64(0xbc3bca5e655e5e94ULL), LE64(0xbe3ec25f615f5f9dULL),
	LE64(0xc0fd27609d606047ULL), LE64(0xc2f82f619961614eULL), LE64(0xc4f7376295626255ULL), LE64(0xc6f23f639163635cULL),
	LE64(0xc8e907648d646463ULL), LE64(0xcaec0f658965656aULL), LE64(0xcce3176685666671ULL), LE64(0xcee61f6781676778ULL),
	LE64(0xd0d56768bd68680fULL), LE64(0xd2d06f69b9696906ULL), LE64(0xd4df776ab56a6a1dULL), LE64(0xd6da7f6bb16b6b14ULL),
	LE64(0xd8c1476cad6c6c2bULL), LE64(0xdac44f6da96d6d22ULL), LE64(0xdccb576ea56e6e39ULL), LE64(0xdece5f6fa16f6f30ULL),
	LE64(0xe0ada770dd7070d7ULL), LE64(0xe2a8af71d97171deULL), LE64(0xe4a7b772d57272c5ULL), LE64(0xe6a2bf73d17373ccULL),
	LE64(0xe8b98774cd7474f3ULL), LE64(0xeabc8f75c97575faULL), LE64(0xecb39776c57676e1ULL), LE64(0xeeb69f77c17777e8ULL),
	LE64(0xf085e778fd78789fULL), LE64(0xf280ef79f9797996ULL), LE64(0xf48ff77af57a7a8dULL), LE64(0xf68aff7bf17b7b84ULL),
	LE64(0xf891c77ced7c7cbbULL), LE64(0xfa94cf7de97d7db2ULL), LE64(0xfc9bd77ee57e7ea9ULL), LE64(0xfe9edf7fe17f7fa0ULL),
	LE64(0x1dba74803a8080f4ULL), LE64(0x1fbf7c813e8181fdULL), LE64(0x19b06482328282e6ULL), LE64(0x1bb56c83368383efULL),
	LE64(0x15ae54842a8484d0ULL), LE64(0x17ab5c852e8585d9ULL), LE64(0x11a44486228686c2ULL), LE64(0x13a14c87268787cbULL),
	LE64(0x0d9234881a8888bcULL), LE64(0x0f973c891e8989b5ULL), LE64(0x0998248a128a8aaeULL), LE64(0x0b9d2c8b168b8ba7ULL),
	LE64(0x0586148c0a8c8c98ULL), LE64(0x07831c8d0e8d8d91ULL), LE64(0x018c048e028e8e8aULL), LE64(0x03890c8f068f8f83ULL),
	LE64(0x3deaf4907a909064ULL), LE64(0x3feffc917e91916dULL), LE64(0x39e0e49272929276ULL), LE64(0x3be5ec937693937fULL),
	LE64(0x35fed4946a949440ULL), LE64(0x37fbdc956e959549ULL), LE64(0x31f4c49662969652ULL), LE64(0x33f1cc976697975bULL),
	LE64(0x2dc2b4985a98982cULL), LE64(0x2fc7bc995e999925ULL), LE64(0x29c8a49a529a9a3eULL), LE64(0x2bcdac9b569b9b37ULL),
	LE64(0x25d6949c4a9c9c08ULL), LE64(0x27d39c9d4e9d9d01ULL), LE64(0x21dc849e429e9e1aULL), LE64(0x23d98c9f469f9f13ULL),
	LE64(0x5d1a69a0baa0a0c9ULL), LE64(0x5f1f61a1bea1a1c0ULL), LE64(0x591079a2b2a2a2dbULL), LE64(0x5b1571a3b6a3a3d2ULL),
	LE64(0x550e49a4aaa4a4edULL), LE64(0x570b41a5aea5a5e4ULL), LE64(0x510459a6a2a6a6ffULL), LE64(0x530151a7a6a7a7f6ULL),
	LE64(0x4d3229a89aa8a881ULL), LE64(0x4f3721a99ea9a988ULL), LE64(0x493839aa92aaaa93ULL), LE64(0x4b3d31ab96abab9aULL),
	LE64(0x452609ac8aacaca5ULL), LE64(0x472301ad8eadadacULL), LE64(0x412c19ae82aeaeb7ULL), LE64(0x432911af86afafbeULL),
	LE64(0x7d4ae9b0fab0b059ULL), LE64(0x7f4fe1b1feb1b150ULL), LE64(0x7940f9b2f2b2b24bULL), LE64(0x7b45f1b3f6b3b342ULL),
	LE64(0x755ec9b4eab4b47dULL), LE64(0x775bc1b5eeb5b574ULL), LE64(0x7154d9b6e2b6b66fULL), LE64(0x7351d1b7e6b7b766ULL),
	LE64(0x6d62a9b8dab8b811ULL), LE64(0x6f67a1b9deb9b918ULL), LE64(0x6968b9bad2baba03ULL), LE64(0x6b6db1bbd6bbbb0aULL),
	LE64(0x657689bccabcbc35ULL), LE64(0x677381bdcebdbd3cULL), LE64(0x617c99bec2bebe27ULL), LE64(0x637991bfc6bfbf2eULL),
	LE64(0x9de74ec027c0c08eULL), LE64(0x9fe246c123c1c187ULL), LE64(0x99ed5ec22fc2c29cULL), LE64(0x9be856c32bc3c395ULL),
	LE64(0x95f36ec437c4c4aaULL), LE64(0x97f666c533c5c5a3ULL), LE64(0x91f97ec63fc6c6b8ULL), LE64(0x93fc76c73bc7c7b1ULL),
	LE64(0x8dcf0ec807c8c8c6ULL), LE64(0x8fca06c903c9c9cfULL), LE64(0x89c51eca0fcacad4ULL), LE64(0x8bc016cb0bcbcbddULL),
	LE64(0x85db2ecc17cccce2ULL), LE64(0x87de26cd13cdcdebULL), LE64(0x81d13ece1fcecef0ULL), LE64(0x83d436cf1bcfcff9ULL),
	LE64(0xbdb7ced067d0d01eULL), LE64(0xbfb2c6d163d1d117ULL), LE64(0xb9bdded26fd2d20cULL), LE64(0xbbb8d6d36bd3d305ULL),
	LE64(0xb5a3eed477d4d43aULL), LE64(0xb7a6e6d573d5d533ULL), LE64(0xb1a9fed67fd6d628ULL), LE64(0xb3acf6d77bd7d721ULL),
	LE64(0xad9f8ed847d8d856ULL), LE64(0xaf9a86d943d9d95fULL), LE64(0xa9959eda4fdada44ULL), LE64(0xab9096db4bdbdb4dULL),
	LE64(0xa58baedc57dcdc72ULL), LE64(0xa78ea6dd53dddd7bULL), LE64(0xa181bede5fdede60ULL), LE64(0xa384b6df5bdfdf69ULL),
	LE64(0xdd4753e0a7e0e0b3ULL), LE64(0xdf425be1a3e1e1baULL), LE64(0xd94d43e2afe2e2a1ULL), LE64(0xdb484be3abe3e3a8ULL),
	LE64(0xd55373e4b7e4e497ULL), LE64(0xd7567be5b3e5e59eULL), LE64(0xd15963e6bfe6e685ULL), LE64(0xd35c6be7bbe7e78cULL),
	LE64(0xcd6f13e887e8e8fbULL), LE64(0xcf6a1be983e9e9f2ULL), LE64(0xc96503ea8feaeae9ULL), LE64(0xcb600beb8bebebe0ULL),
	LE64(0xc57b33ec97ececdfULL), LE64(0xc77e3bed93ededd6ULL), LE64(0xc17123ee9feeeecdULL), LE64(0xc3742bef9befefc4ULL),
	LE64(0xfd17d3f0e7f0f023ULL), LE64(0xff12dbf1e3f1f12aULL), LE64(0xf91dc3f2eff2f231ULL), LE64(0xfb18cbf3ebf3f338ULL),
	LE64(0xf503f3f4f7f4f407ULL), LE64(0xf706fbf5f3f5f50eULL), LE64(0xf109e3f6fff6f615ULL), LE64(0xf30cebf7fbf7f71cULL),
	LE64(0xed3f93f8c7f8f86bULL), LE64(0xef3a9bf9c3f9f962ULL), LE64(0xe93583facffafa79ULL), LE64(0xeb308bfbcbfbfb70ULL),
	LE64(0xe52bb3fcd7fcfc4fULL), LE64(0xe72ebbfdd3fdfd46ULL), LE64(0xe121a3fedffefe5dULL), LE64(0xe324abffdbffff54ULL)
};
const uint64_t W2[] = {
	LE64(0x0000000000000000ULL), LE64(0x0508010401010902ULL), LE64(0x0a10020802021204ULL), LE64(0x0f18030c03031b06ULL),
	LE64(0x1420041004042408ULL), LE64(0x1128051405052d0aULL), LE64(0x1e3006180606360cULL), LE64(0x1b38071c07073f0eULL),
	LE64(0x2840082008084810ULL), LE64(0x2d48092409094112ULL), LE64(0x22500a280a0a5a14ULL), LE64(0x27580b2c0b0b5316ULL),
	LE64(0x3c600c300c0c6c18ULL), LE64(0x39680d340d0d651aULL), LE64(0x36700e380e0e7e1cULL), LE64(0x33780f3c0f0f771eULL),
	LE64(0x5080104010109020ULL), LE64(0x5588114411119922ULL), LE64(0x5a90124812128224ULL), LE64(0x5f98134c13138b26ULL),
	LE64(0x44a014501414b428ULL), LE64(0x41a815541515bd2aULL), LE64(0x4eb016581616a62cULL), LE64(0x4bb8175c1717af2eULL),
	LE64(0x78c018601818d830ULL), LE64(0x7dc819641919d132ULL), LE64(0x72d01a681a1aca34ULL), LE64(0x77d81b6c1b1bc336ULL),
	LE64(0x6ce01c701c1cfc38ULL), LE64(0x69e81d741d1df53aULL), LE64(0x66f01e781e1eee3cULL), LE64(0x63f81f7c1f1fe73eULL),
	LE64(0xa01d208020203d40ULL), LE64(0xa515218421213442ULL), LE64(0xaa0d228822222f44ULL), LE64(0xaf05238c23232646ULL),
	LE64(0xb43d249024241948ULL), LE64(0xb13525942525104aULL), LE64(0xbe2d269826260b4cULL), LE64(0xbb25279c2727024eULL),
	LE64(0x885d28a028287550ULL), LE64(0x8d5529a429297c52ULL), LE64(0x824d2aa82a2a6754ULL), LE64(0x87452bac2b2b6e56ULL),
	LE64(0x9c7d2cb02c2c5158ULL), LE64(0x99752db42d2d585aULL), LE64(0x966d2eb82e2e435cULL), LE64(0x93652fbc2f2f4a5eULL),
	LE64(0xf09d30c03030ad60ULL), LE64(0xf59531c43131a462ULL), LE64(0xfa8d32c83232bf64ULL), LE64(0xff8533cc3333b666ULL),
	LE64(0xe4bd34d034348968ULL), LE64(0xe1b535d43535806aULL), LE64(0xeead36d836369b6cULL), LE64(0xeba537dc3737926eULL),
	LE64(0xd8dd38e03838e570ULL), LE64(0xddd539e43939ec72ULL), LE64(0xd2cd3ae83a3af774ULL), LE64(0xd7c53bec3b3bfe76ULL),
	LE64(0xccfd3cf03c3cc178ULL), LE64(0xc9f53df43d3dc87aULL), LE64(0xc6ed3ef83e3ed37cULL), LE64(0xc3e53ffc3f3fda7eULL),
	LE64(0x5d3a401d40407a80ULL), LE64(0x5832411941417382ULL), LE64(0x572a421542426884ULL), LE64(0x5222431143436186ULL),
	LE64(0x491a440d44445e88ULL), LE64(0x4c1245094545578aULL), LE64(0x430a460546464c8cULL), LE64(0x460247014747458eULL),
	LE64(0x757a483d48483290ULL), LE64(0x7072493949493b92ULL), LE64(0x7f6a4a354a4a2094ULL), LE64(0x7a624b314b4b2996ULL),
	LE64(0x615a4c2d4c4c1698ULL), LE64(0x64524d294d4d1f9aULL), LE64(0x6b4a4e254e4e049cULL), LE64(0x6e424f214f4f0d9eULL),
	LE64(0x0dba505d5050eaa0ULL), LE64(0x08b251595151e3a2ULL), LE64(0x07aa52555252f8a4ULL), LE64(0x02a253515353f1a6ULL),
	LE64(0x199a544d5454cea8ULL), LE64(0x1c9255495555c7aaULL), LE64(0x138a56455656dcacULL), LE64(0x168257415757d5aeULL),
	LE64(0x25fa587d5858a2b0ULL), LE64(0x20f259795959abb2ULL), LE64(0x2fea5a755a5ab0b4ULL), LE64(0x2ae25b715b5bb9b6ULL),
	LE64(0x31da5c6d5c5c86b8ULL), LE64(0x34d25d695d5d8fbaULL), LE64(0x3bca5e655e5e94bcULL), LE64(0x3ec25f615f5f9dbeULL),
	LE64(0xfd27609d606047c0ULL), LE64(0xf82f619961614ec2ULL), LE64(0xf7376295626255c4ULL), LE64(0xf23f639163635cc6ULL),
	LE64(0xe907648d646463c8ULL), LE64(0xec0f658965656acaULL), LE64(0xe3176685666671ccULL), LE64(0xe61f6781676778ceULL),
	LE64(0xd56768bd68680fd0ULL), LE64(0xd06f69b9696906d2ULL), LE64(0xdf776ab56a6a1dd4ULL), LE64(0xda7f6bb16b6b14d6ULL),
	LE64(0xc1476cad6c6c2bd8ULL), LE64(0xc44f6da96d6d22daULL), LE64(0xcb576ea56e6e39dcULL), LE64(0xce5f6fa16f6f30deULL),
	LE64(0xada770dd7070d7e0ULL), LE64(0xa8af71d97171dee2ULL), LE64(0xa7b772d57272c5e4ULL), LE64(0xa2bf73d17373cce6ULL),
	LE64(0xb98774cd7474f3e8ULL), LE64(0xbc8f75c97575faeaULL), LE64(0xb39776c57676e1ecULL), LE64(0xb69f77c17777e8eeULL),
	LE64(0x85e778fd78789ff0ULL), LE64(0x80ef79f9797996f2ULL), LE64(0x8ff77af57a7a8df4ULL), LE64(0x8aff7bf17b7b84f6ULL),
	LE64(0x91c77ced7c7cbbf8ULL), LE64(0x94cf7de97d7db2faULL), LE64(0x9bd77ee57e7ea9fcULL), LE64(0x9edf7fe17f7fa0feULL),
	LE64(0xba74803a8080f41dULL), LE64(0xbf7c813e8181fd1fULL), LE64(0xb06482328282e619ULL), LE64(0xb56c83368383ef1bULL),
	LE64(0xae54842a8484d015ULL), LE64(0xab5c852e8585d917ULL), LE64(0xa44486228686c211ULL), LE64(0xa14c87268787cb13ULL),
	LE64(0x9234881a8888bc0dULL), LE64(0x973c891e8989b50fULL), LE64(0x98248a128a8aae09ULL), LE64(0x9d2c8b168b8ba70bULL),
	LE64(0x86148c0a8c8c9805ULL), LE64(0x831c8d0e8d8d9107ULL), LE64(0x8c048e028e8e8a01ULL), LE64(0x890c8f068f8f8303ULL),
	LE64(0xeaf4907a9090643dULL), LE64(0xeffc917e91916d3fULL), LE64(0xe0e4927292927639ULL), LE64(0xe5ec937693937f3bULL),
	LE64(0xfed4946a94944035ULL), LE64(0xfbdc956e95954937ULL), LE64(0xf4c4966296965231ULL), LE64(0xf1cc976697975b33ULL),
	LE64(0xc2b4985a98982c2dULL), LE64(0xc7bc995e9999252fULL), LE64(0xc8a49a529a9a3e29ULL), LE64(0xcdac9b569b9b372bULL),
	LE64(0xd6949c4a9c9c0825ULL), LE64(0xd39c9d4e9d9d0127ULL), LE64(0xdc849e429e9e1a21ULL), LE64(0xd98c9f469f9f1323ULL),
	LE64(0x1a69a0baa0a0c95dULL), LE64(0x1f61a1bea1a1c05fULL), LE64(0x1079a2b2a2a2db59ULL), LE64(0x1571a3b6a3a3d25bULL),
	LE64(0x0e49a4aaa4a4ed55ULL), LE64(0x0b41a5aea5a5e457ULL), LE64(0x0459a6a2a6a6ff51ULL), LE64(0x0151a7a6a7a7f653ULL),
	LE64(0x3229a89aa8a8814dULL), LE64(0x3721a99ea9a9884fULL), LE64(0x3839aa92aaaa9349ULL), LE64(0x3d31ab96abab9a4bULL),
	LE64(0x2609ac8aacaca545ULL), LE64(0x2301ad8eadadac47ULL), LE64(0x2c19ae82aeaeb741ULL), LE64(0x2911af86afafbe43ULL),
	LE64(0x4ae9b0fab0b0597dULL), LE64(0x4fe1b1feb1b1507fULL), LE64(0x40f9b2f2b2b24b79ULL), LE64(0x45f1b3f6b3b3427bULL),
	LE64(0x5ec9b4eab4b47d75ULL), LE64(0x5bc1b5eeb5b57477ULL), LE64(0x54d9b6e2b6b66f71ULL), LE64(0x51d1b7e6b7b76673ULL),
	LE64(0x62a9b8dab8b8116dULL), LE64(0x67a1b9deb9b9186fULL), LE64(0x68b9bad2baba0369ULL), LE64(0x6db1bbd6bbbb0a6bULL),
	LE64(0x7689bccabcbc3565ULL), LE64(0x7381bdcebdbd3c67ULL), LE64(0x7c99bec2bebe2761ULL), LE64(0x7991bfc6bfbf2e63ULL),
	LE64(0xe74ec027c0c08e9dULL), LE64(0xe246c123c1c1879fULL), LE64(0xed5ec22fc2c29c99ULL), LE64(0xe856c32bc3c3959bULL),
	LE64(0xf36ec437c4c4aa95ULL), LE64(0xf666c533c5c5a397ULL), LE64(0xf97ec63fc6c6b891ULL), LE64(0xfc76c73bc7c7b193ULL),
	LE64(0xcf0ec807c8c8c68dULL), LE64(0xca06c903c9c9cf8fULL), LE64(0xc51eca0fcacad489ULL), LE64(0xc016cb0bcbcbdd8bULL),
	LE64(0xdb2ecc17cccce285ULL), LE64(0xde26cd13cdcdeb87ULL), LE64(0xd13ece1fcecef081ULL), LE64(0xd436cf1bcfcff983ULL),
	LE64(0xb7ced067d0d01ebdULL), LE64(0xb2c6d163d1d117bfULL), LE64(0xbdded26fd2d20cb9ULL), LE64(0xb8d6d36bd3d305bbULL),
	LE64(0xa3eed477d4d43ab5ULL), LE64(0xa6e6d573d5d533b7ULL), LE64(0xa9fed67fd6d628b1ULL), LE64(0xacf6d77bd7d721b3ULL),
	LE64(0x9f8ed847d8d856adULL), LE64(0x9a86d943d9d95fafULL), LE64(0x959eda4fdada44a9ULL), LE64(0x9096db4bdbdb4dabULL),
	LE64(0x8baedc57dcdc72a5ULL), LE64(0x8ea6dd53dddd7ba7ULL), LE64(0x81bede5fdede60a1ULL), LE64(0x84b6df5bdfdf69a3ULL),
	LE64(0x4753e0a7e0e0b3ddULL), LE64(0x425be1a3e1e1badfULL), LE64(0x4d43e2afe2e2a1d9ULL), LE64(0x484be3abe3e3a8dbULL),
	LE64(0x5373e4b7e4e497d5ULL), LE64(0x567be5b3e5e59ed7ULL), LE64(0x5963e6bfe6e685d1ULL), LE64(0x5c6be7bbe7e78cd3ULL),
	LE64(0x6f13e887e8e8fbcdULL), LE64(0x6a1be983e9e9f2cfULL), LE64(0x6503ea8feaeae9c9ULL), LE64(0x600beb8bebebe0cbULL),
	LE64(0x7b33ec97ececdfc5ULL), LE64(0x7e3bed93ededd6c7ULL), LE64(0x7123ee9feeeecdc1ULL), LE64(0x742bef9befefc4c3ULL),
	LE64(0x17d3f0e7f0f023fdULL), LE64(0x12dbf1e3f1f12affULL), LE64(0x1dc3f2eff2f231f9ULL), LE64(0x18cbf3ebf3f338fbULL),
	LE64(0x03f3f4f7f4f407f5ULL), LE64(0x06fbf5f3f5f50ef7ULL), LE64(0x09e3f6fff6f615f1ULL), LE64(0x0cebf7fbf7f71cf3ULL),
	LE64(0x3f93f8c7f8f86bedULL), LE64(0x3a9bf9c3f9f962efULL), LE64(0x3583facffafa79e9ULL), LE64(0x308bfbcbfbfb70ebULL),
	LE64(0x2bb3fcd7fcfc4fe5ULL), LE64(0x2ebbfdd3fdfd46e7ULL), LE64(0x21a3fedffefe5de1ULL), LE64(0x24abffdbffff54e3ULL)
};
const uint64_t W3[] = {
	LE64(0x0000000000000000ULL), LE64(0x0801040101090205ULL), LE64(0x100208020212040aULL), LE64(0x18030c03031b060fULL),
	LE64(0x2004100404240814ULL), LE64(0x28051405052d0a11ULL), LE64(0x3006180606360c1eULL), LE64(0x38071c07073f0e1bULL),
	LE64(0x4008200808481028ULL), LE64(0x480924090941122dULL), LE64(0x500a280a0a5a1422ULL), LE64(0x580b2c0b0b531627ULL),
	LE64(0x600c300c0c6c183cULL), LE64(0x680d340d0d651a39ULL), LE64(0x700e380e0e7e1c36ULL), LE64(0x780f3c0f0f771e33ULL),
	LE64(0x8010401010902050ULL), LE64(0x8811441111992255ULL), LE64(0x901248121282245aULL), LE64(0x98134c13138b265fULL),
	LE64(0xa014501414b42844ULL), LE64(0xa815541515bd2a41ULL), LE64(0xb016581616a62c4eULL), LE64(0xb8175c1717af2e4bULL),
	LE64(0xc018601818d83078ULL), LE64(0xc819641919d1327dULL), LE64(0xd01a681a1aca3472ULL), LE64(0xd81b6c1b1bc33677ULL),
	LE64(0xe01c701c1cfc386cULL), LE64(0xe81d741d1df53a69ULL), LE64(0xf01e781e1eee3c66ULL), LE64(0xf81f7c1f1fe73e63ULL),
	LE64(0x1d208020203d40a0ULL), LE64(0x15218421213442a5ULL), LE64(0x0d228822222f44aaULL), LE64(0x05238c23232646afULL),
	LE64(0x3d249024241948b4ULL), LE64(0x3525942525104ab1ULL), LE64(0x2d269826260b4cbeULL), LE64(0x25279c2727024ebbULL),
	LE64(0x5d28a02828755088ULL), LE64(0x5529a429297c528dULL), LE64(0x4d2aa82a2a675482ULL), LE64(0x452bac2b2b6e5687ULL),
	LE64(0x7d2cb02c2c51589cULL), LE64(0x752db42d2d585a99ULL), LE64(0x6d2eb82e2e435c96ULL), LE64(0x652fbc2f2f4a5e93ULL),
	LE64(0x9d30c03030ad60f0ULL), LE64(0x9531c43131a462f5ULL), LE64(0x8d32c83232bf64faULL), LE64(0x8533cc3333b666ffULL),
	LE64(0xbd34d034348968e4ULL), LE64(0xb535d43535806ae1ULL), LE64(0xad36d836369b6ceeULL), LE64(0xa537dc3737926eebULL),
	LE64(0xdd38e03838e570d8ULL), LE64(0xd539e43939ec72ddULL), LE64(0xcd3ae83a3af774d2ULL), LE64(0xc53bec3b3bfe76d7ULL),
	LE64(0xfd3cf03c3cc178ccULL), LE64(0xf53df43d3dc87ac9ULL), LE64(0xed3ef83e3ed37cc6ULL), LE64(0xe53ffc3f3fda7ec3ULL),
	LE64(0x3a401d40407a805dULL), LE64(0x3241194141738258ULL), LE64(0x2a42154242688457ULL), LE64(0x2243114343618652ULL),
	LE64(0x1a440d44445e8849ULL), LE64(0x1245094545578a4cULL), LE64(0x0a460546464c8c43ULL), LE64(0x0247014747458e46ULL),
	LE64(0x7a483d4848329075ULL), LE64(0x72493949493b9270ULL), LE64(0x6a4a354a4a20947fULL), LE64(0x624b314b4b29967aULL),
	LE64(0x5a4c2d4c4c169861ULL), LE64(0x524d294d4d1f9a64ULL), LE64(0x4a4e254e4e049c6bULL), LE64(0x424f214f4f0d9e6eULL),
	LE64(0xba505d5050eaa00dULL), LE64(0xb251595151e3a208ULL), LE64(0xaa52555252f8a407ULL), LE64(0xa253515353f1a602ULL),
	LE64(0x9a544d5454cea819ULL), LE64(0x9255495555c7aa1cULL), LE64(0x8a56455656dcac13ULL), LE64(0x8257415757d5ae16ULL),
	LE64(0xfa587d5858a2b025ULL), LE64(0xf259795959abb220ULL), LE64(0xea5a755a5ab0b42fULL), LE64(0xe25b715b5bb9b62aULL),
	LE64(0xda5c6d5c5c86b831ULL), LE64(0xd25d695d5d8fba34ULL), LE64(0xca5e655e5e94bc3bULL), LE64(0xc25f615f5f9dbe3eULL),
	LE64(0x27609d606047c0fdULL), LE64(0x2f619961614ec2f8ULL), LE64(0x376295626255c4f7ULL), LE64(0x3f639163635cc6f2ULL),
	LE64(0x07648d646463c8e9ULL), LE64(0x0f658965656acaecULL), LE64(0x176685666671cce3ULL), LE64(0x1f6781676778cee6ULL),
	LE64(0x6768bd68680fd0d5ULL), LE64(0x6f69b9696906d2d0ULL), LE64(0x776ab56a6a1dd4dfULL), LE64(0x7f6bb16b6b14d6daULL),
	LE64(0x476cad6c6c2bd8c1ULL), LE64(0x4f6da96d6d22dac4ULL), LE64(0x576ea56e6e39dccbULL), LE64(0x5f6fa16f6f30deceULL),
	LE64(0xa770dd7070d7e0adULL), LE64(0xaf71d97171dee2a8ULL), LE64(0xb772d57272c5e4a7ULL), LE64(0xbf73d17373cce6a2ULL),
	LE64(0x8774cd7474f3e8b9ULL), LE64(0x8f75c97575faeabcULL), LE64(0x9776c57676e1ecb3ULL), LE64(0x9f77c17777e8eeb6ULL),
	LE64(0xe778fd78789ff085ULL), LE64(0xef79f9797996f280ULL), LE64(0xf77af57a7a8df48fULL), LE64(0xff7bf17b7b84f68aULL),
	LE64(0xc77ced7c7cbbf891ULL), LE64(0xcf7de97d7db2fa94ULL), LE64(0xd77ee57e7ea9fc9bULL), LE64(0xdf7fe17f7fa0fe9eULL),
	LE64(0x74803a8080f41dbaULL), LE64(0x7c813e8181fd1fbfULL), LE64(0x6482328282e619b0ULL), LE64(0x6c83368383ef1bb5ULL),
	LE64(0x54842a8484d015aeULL), LE64(0x5c852e8585d917abULL), LE64(0x4486228686c211a4ULL), LE64(0x4c87268787cb13a1ULL),
	LE64(0x34881a8888bc0d92ULL), LE64(0x3c891e8989b50f97ULL), LE64(0x248a128a8aae0998ULL), LE64(0x2c8b168b8ba70b9dULL),
	LE64(0x148c0a8c8c980586ULL), LE64(0x1c8d0e8d8d910783ULL), LE64(0x048e028e8e8a018cULL), LE64(0x0c8f068f8f830389ULL),
	LE64(0xf4907a9090643deaULL), LE64(0xfc917e91916d3fefULL), LE64(0xe4927292927639e0ULL), LE64(0xec937693937f3be5ULL),
	LE64(0xd4946a94944035feULL), LE64(0xdc956e95954937fbULL), LE64(0xc4966296965231f4ULL), LE64(0xcc976697975b33f1ULL),
	LE64(0xb4985a98982c2dc2ULL), LE64(0xbc995e9999252fc7ULL), LE64(0xa49a529a9a3e29c8ULL), LE64(0xac9b569b9b372bcdULL),
	LE64(0x949c4a9c9c0825d6ULL), LE64(0x9c9d4e9d9d0127d3ULL), LE64(0x849e429e9e1a21dcULL), LE64(0x8c9f469f9f1323d9ULL),
	LE64(0x69a0baa0a0c95d1aULL), LE64(0x61a1bea1a1c05f1fULL), LE64(0x79a2b2a2a2db5910ULL), LE64(0x71a3b6a3a3d25b15ULL),
	LE64(0x49a4aaa4a4ed550eULL), LE64(0x41a5aea5a5e4570bULL), LE64(0x59a6a2a6a6ff5104ULL), LE64(0x51a7a6a7a7f65301ULL),
	LE64(0x29a89aa8a8814d32ULL), LE64(0x21a99ea9a9884f37ULL), LE64(0x39aa92aaaa934938ULL), LE64(0x31ab96abab9a4b3dULL),
	LE64(0x09ac8aacaca54526ULL), LE64(0x01ad8eadadac4723ULL), LE64(0x19ae82aeaeb7412cULL), LE64(0x11af86afafbe4329ULL),
	LE64(0xe9b0fab0b0597d4aULL), LE64(0xe1b1feb1b1507f4fULL), LE64(0xf9b2f2b2b24b7940ULL), LE64(0xf1b3f6b3b3427b45ULL),
	LE64(0xc9b4eab4b47d755eULL), LE64(0xc1b5eeb5b574775bULL), LE64(0xd9b6e2b6b66f7154ULL), LE64(0xd1b7e6b7b7667351ULL),
	LE64(0xa9b8dab8b8116d62ULL), LE64(0xa1b9deb9b9186f67ULL), LE64(0xb9bad2baba036968ULL), LE64(0xb1bbd6bbbb0a6b6dULL),
	LE64(0x89bccabcbc356576ULL), LE64(0x81bdcebdbd3c6773ULL), LE64(0x99bec2bebe27617cULL), LE64(0x91bfc6bfbf2e6379ULL),
	LE64(0x4ec027c0c08e9de7ULL), LE64(0x46c123c1c1879fe2ULL), LE64(0x5ec22fc2c29c99edULL), LE64(0x56c32bc3c3959be8ULL),
	LE64(0x6ec437c4c4aa95f3ULL), LE64(0x66c533c5c5a397f6ULL), LE64(0x7ec63fc6c6b891f9ULL), LE64(0x76c73bc7c7b193fcULL),
	LE64(0x0ec807c8c8c68dcfULL), LE64(0x06c903c9c9cf8fcaULL), LE64(0x1eca0fcacad489c5ULL), LE64(0x16cb0bcbcbdd8bc0ULL),
	LE64(0x2ecc17cccce285dbULL), LE64(0x26cd13cdcdeb87deULL), LE64(0x3ece1fcecef081d1ULL), LE64(0x36cf1bcfcff983d4ULL),
	LE64(0xced067d0d01ebdb7ULL), LE64(0xc6d163d1d117bfb2ULL), LE64(0xded26fd2d20cb9bdULL), LE64(0xd6d36bd3d305bbb8ULL),
	LE64(0xeed477d4d43ab5a3ULL), LE64(0xe6d573d5d533b7a6ULL), LE64(0xfed67fd6d628b1a9ULL), LE64(0xf6d77bd7d721b3acULL),
	LE64(0x8ed847d8d856ad9fULL), LE64(0x86d943d9d95faf9aULL), LE64(0x9eda4fdada44a995ULL), LE64(0x96db4bdbdb4dab90ULL),
	LE64(0xaedc57dcdc72a58bULL), LE64(0xa6dd53dddd7ba78eULL), LE64(0xbede5fdede60a181ULL), LE64(0xb6df5bdfdf69a384ULL),
	LE64(0x53e0a7e0e0b3dd47ULL), LE64(0x5be1a3e1e1badf42ULL), LE64(0x43e2afe2e2a1d94dULL), LE64(0x4be3abe3e3a8db48ULL),
	LE64(0x73e4b7e4e497d553ULL), LE64(0x7be5b3e5e59ed756ULL), LE64(0x63e6bfe6e685d159ULL), LE64(0x6be7bbe7e78cd35cULL),
	LE64(0x13e887e8e8fbcd6fULL), LE64(0x1be983e9e9f2cf6aULL), LE64(0x03ea8feaeae9c965ULL), LE64(0x0beb8bebebe0cb60ULL),
	LE64(0x33ec97ececdfc57bULL), LE64(0x3bed93ededd6c77eULL), LE64(0x23ee9feeeecdc171ULL), LE64(0x2bef9befefc4c374ULL),
	LE64(0xd3f0e7f0f023fd17ULL), LE64(0xdbf1e3f1f12aff12ULL), LE64(0xc3f2eff2f231f91dULL), LE64(0xcbf3ebf3f338fb18ULL),
	LE64(0xf3f4f7f4f407f503ULL), LE64(0xfbf5f3f5f50ef706ULL), LE64(0xe3f6fff6f615f109ULL), LE64(0xebf7fbf7f71cf30cULL),
	LE64(0x93f8c7f8f86bed3fULL), LE64(0x9bf9c3f9f962ef3aULL), LE64(0x83facffafa79e935ULL), LE64(0x8bfbcbfbfb70eb30ULL),
	LE64(0xb3fcd7fcfc4fe52bULL), LE64(0xbbfdd3fdfd46e72eULL), LE64(0xa3fedffefe5de121ULL), LE64(0xabffdbffff54e324ULL)
};

/* Substitution box Sw for the internal cipher W[K](m). */
static const uint8_t sbox[256] = {
  0x18, 0x23, 0xc6, 0xe8, 0x87, 0xb8, 0x01, 0x4f, 0x36, 0xa6, 0xd2, 0xf5, 0x79, 0x6f, 0x91, 0x52,
  0x60, 0xbc, 0x9b, 0x8e, 0xa3, 0x0c, 0x7b, 0x35, 0x1d, 0xe0, 0xd7, 0xc2, 0x2e, 0x4b, 0xfe, 0x57,
  0x15, 0x77, 0x37, 0xe5, 0x9f, 0xf0, 0x4a, 0xda, 0x58, 0xc9, 0x29, 0x0a, 0xb1, 0xa0, 0x6b, 0x85,
  0xbd, 0x5d, 0x10, 0xf4, 0xcb, 0x3e, 0x05, 0x67, 0xe4, 0x27, 0x41, 0x8b, 0xa7, 0x7d, 0x95, 0xd8,
  0xfb, 0xee, 0x7c, 0x66, 0xdd, 0x17, 0x47, 0x9e, 0xca, 0x2d, 0xbf, 0x07, 0xad, 0x5a, 0x83, 0x33,
  0x63, 0x02, 0xaa, 0x71, 0xc8, 0x19, 0x49, 0xd9, 0xf2, 0xe3, 0x5b, 0x88, 0x9a, 0x26, 0x32, 0xb0,
  0xe9, 0x0f, 0xd5, 0x80, 0xbe, 0xcd, 0x34, 0x48, 0xff, 0x7a, 0x90, 0x5f, 0x20, 0x68, 0x1a, 0xae,
  0xb4, 0x54, 0x93, 0x22, 0x64, 0xf1, 0x73, 0x12, 0x40, 0x08, 0xc3, 0xec, 0xdb, 0xa1, 0x8d, 0x3d,
  0x97, 0x00, 0xcf, 0x2b, 0x76, 0x82, 0xd6, 0x1b, 0xb5, 0xaf, 0x6a, 0x50, 0x45, 0xf3, 0x30, 0xef,
  0x3f, 0x55, 0xa2, 0xea, 0x65, 0xba, 0x2f, 0xc0, 0xde, 0x1c, 0xfd, 0x4d, 0x92, 0x75, 0x06, 0x8a,
  0xb2, 0xe6, 0x0e, 0x1f, 0x62, 0xd4, 0xa8, 0x96, 0xf9, 0xc5, 0x25, 0x59, 0x84, 0x72, 0x39, 0x4c,
  0x5e, 0x78, 0x38, 0x8c, 0xd1, 0xa5, 0xe2, 0x61, 0xb3, 0x21, 0x9c, 0x1e, 0x43, 0xc7, 0xfc, 0x04,
  0x51, 0x99, 0x6d, 0x0d, 0xfa, 0xdf, 0x7e, 0x24, 0x3b, 0xab, 0xce, 0x11, 0x8f, 0x4e, 0xb7, 0xeb,
  0x3c, 0x81, 0x94, 0xf7, 0xb9, 0x13, 0x2c, 0xd3, 0xe7, 0x6e, 0xc4, 0x03, 0x56, 0x44, 0x7f, 0xa9,
  0x2a, 0xbb, 0xc1, 0x53, 0xdc, 0x0b, 0x9d, 0x6c, 0x31, 0x74, 0xf6, 0x46, 0xac, 0x89, 0x14, 0xe1,
  0x16, 0x3a, 0x69, 0x09, 0x70, 0xb6, 0xd0, 0xed, 0xcc, 0x42, 0x98, 0xa4, 0x28, 0x5c, 0xf8, 0x86
};

#define SBOX64(x) \
( \
	(uint64_t) sbox[(x) & 0xff] | \
	(uint64_t) sbox[((x) >> 8) & 0xff] << 8 | \
	(uint64_t) sbox[((x) >> 16) & 0xff] << 16 | \
	(uint64_t) sbox[((x) >> 24) & 0xff] << 24 | \
	(uint64_t) sbox[((x) >> 32) & 0xff] << 32 | \
	(uint64_t) sbox[((x) >> 40) & 0xff] << 40 | \
	(uint64_t) sbox[((x) >> 48) & 0xff] << 48 | \
	(uint64_t) sbox[(x) >> 56] << 56 \
)

/* Substitutes each byte of 8x8 state using S-box Sw. */
static inline void
sub_bytes(uint64_t state[8])
{
	state[0] = SBOX64(state[0]);
	state[1] = SBOX64(state[1]);
	state[2] = SBOX64(state[2]);
	state[3] = SBOX64(state[3]);
	state[4] = SBOX64(state[4]);
	state[5] = SBOX64(state[5]);
	state[6] = SBOX64(state[6]);
	state[7] = SBOX64(state[7]);
}

#if __BYTE_ORDER == __LITTLE_ENDIAN
#define MIX64(x) \
( \
	W0[(x) & 0xff] ^ \
	W1[((x) >> 8) & 0xff] ^ \
	W2[((x) >> 16) & 0xff] ^ \
	W3[((x) >> 24) & 0xff] ^ \
	R64(W0[((x) >> 32) & 0xff]) ^ \
	R64(W1[((x) >> 40) & 0xff]) ^ \
	R64(W2[((x) >> 48) & 0xff]) ^ \
	R64(W3[((x) >> 56) & 0xff]) \
)
#elif __BYTE_ORDER == __BIG_ENDIAN
#define MIX64(x) \
( \
	W0[((x) >> 56) & 0xff] ^ \
	W1[((x) >> 48) & 0xff] ^ \
	W2[((x) >> 40) & 0xff] ^ \
	W3[((x) >> 32) & 0xff] ^ \
	R64(W0[((x) >> 24) & 0xff]) ^ \
	R64(W1[((x) >> 16) & 0xff]) ^ \
	R64(W2[((x) >> 8) & 0xff]) ^ \
	R64(W3[(x) & 0xff]) \
)
#else
#error unsupported byte order!
#endif

/* Multiplies 8x8 state by diffusion matrix. */
static inline void
mix_rows(uint64_t state[8])
{
	state[0] = MIX64(state[0]);
	state[1] = MIX64(state[1]);
	state[2] = MIX64(state[2]);
	state[3] = MIX64(state[3]);
	state[4] = MIX64(state[4]);
	state[5] = MIX64(state[5]);
	state[6] = MIX64(state[6]);
	state[7] = MIX64(state[7]);
}

/* Shifts each column in 8x8 state M[i,j] down to i places. */
static inline void
shift_columns(uint64_t state[8])
{
	uint8_t *s0, *s1, *s2, *s3, *s4, *s5, *s6, *s7;
	uint64_t x;

#define SHCOL(x, n) \
{ \
	(x)  = ((uint64_t)*s0) | ((uint64_t)*s1 << 8) | \
	       ((uint64_t)*s2 << 16) | ((uint64_t)*s3 << 24); \
	(x) |= ((uint64_t)*s4 << 32) | ((uint64_t)*s5 << 40) | \
	       ((uint64_t)*s6 << 48) | ((uint64_t)*s7 << 56); \
	(x) = ROL64(x, (n)); \
	*s0++ = ((uint64_t)(x)) & 0xff; \
	*s1++ = (((uint64_t)(x)) >> 8) & 0xff; \
	*s2++ = (((uint64_t)(x)) >> 16) & 0xff; \
	*s3++ = (((uint64_t)(x)) >> 24) & 0xff; \
	*s4++ = (((uint64_t)(x)) >> 32) & 0xff; \
	*s5++ = (((uint64_t)(x)) >> 40) & 0xff; \
	*s6++ = (((uint64_t)(x)) >> 48) & 0xff; \
	*s7++ = (((uint64_t)(x)) >> 56) & 0xff; \
}
	s0 = (uint8_t *) state;
	s1 = (uint8_t *)(state + 1);
	s2 = (uint8_t *)(state + 2);
	s3 = (uint8_t *)(state + 3);
	s4 = (uint8_t *)(state + 4);
	s5 = (uint8_t *)(state + 5);
	s6 = (uint8_t *)(state + 6);
	s7 = (uint8_t *)(state + 7);

	++s0; ++s1; ++s2; ++s3;
	++s4; ++s5; ++s6; ++s7;

	SHCOL(x, 8);
	SHCOL(x, 16);
	SHCOL(x, 24);
	SHCOL(x, 32);
	SHCOL(x, 40);
	SHCOL(x, 48);
	SHCOL(x, 56);
}

/* Adds round key to 8x8 state in GF(2^8). */
static inline void
add_round_key(uint64_t state[8], uint64_t rk[8])
{
	state[0] ^= rk[0];
	state[1] ^= rk[1];
	state[2] ^= rk[2];
	state[3] ^= rk[3];
	state[4] ^= rk[4];
	state[5] ^= rk[5];
	state[6] ^= rk[6];
	state[7] ^= rk[7];
}

/* Miyaguchi-Preneel scheme build on-top of internal cipher W[K](m). */
void
whirlpool_hash(uint64_t s[8], const unsigned char buffer[64])
{
	static const uint64_t cr[10] = {
		LE64(0x4f01b887e8c62318LLU), LE64(0x52916f79f5d2a636LLU),
		LE64(0x357b0ca38e9bbc60LLU), LE64(0x57fe4b2ec2d7e01dLLU),
		LE64(0xda4af09fe5377715LLU), LE64(0x856ba0b10a29c958LLU),
		LE64(0x67053ecbf4105dbdLLU), LE64(0xd8957da78b4127e4LLU),
		LE64(0x9e4717dd667ceefbLLU), LE64(0x33835aad07bf2dcaLLU)
	};
	uint64_t state[8];
	uint64_t rkey[8];
	int i;

	/* The key expansion constucts 11 512-bit keys from one 512 bit key. */

	/*
	 * Keys K1...K10 are derived recursively for each round in turn.
	 * Each round key is expanded from the pre—Åeeding round key.
	 */
	
	memcpy(rkey, s, 64);
	memcpy(state, buffer, 64);
	add_round_key(state, rkey);

	for (i = 0; i < 10; i++) {
		sub_bytes(rkey);
		shift_columns(rkey);
		mix_rows(rkey);
		/* add_round_key() is replaced with XOR for round key. */
		rkey[0] ^= cr[i];
		sub_bytes(state);
		shift_columns(state);
		mix_rows(state);
		add_round_key(state, rkey);
	}

	/* Compression using Miyaguchi-Prenelee scheme. */
	s[0] ^= state[0] ^ ((uint64_t *)buffer)[0];
	s[1] ^= state[1] ^ ((uint64_t *)buffer)[1];
	s[2] ^= state[2] ^ ((uint64_t *)buffer)[2];
	s[3] ^= state[3] ^ ((uint64_t *)buffer)[3];
	s[4] ^= state[4] ^ ((uint64_t *)buffer)[4];
	s[5] ^= state[5] ^ ((uint64_t *)buffer)[5];
	s[6] ^= state[6] ^ ((uint64_t *)buffer)[6];
	s[7] ^= state[7] ^ ((uint64_t *)buffer)[7];
}

void
whirlpool_context_init(struct whirlpool_context *ctx)
{
	ctx->count[0] = 0;
	ctx->count[1] = 0;
	memset(ctx->buffer, 0, sizeof(ctx->buffer));
	memset(ctx->state, 0, sizeof(ctx->state));
}

void
whirlpool_update(struct whirlpool_context *ctx, const void *msg, u_int32_t msglen)
{
	unsigned int n, len;

	/* Get length of buffer used. */
	n = ctx->count[0] & 0x3f;

	/* How many space in buffer left? */
	len = 64 - n;

	/* Update bits length. */
	ctx->count[0] += msglen;
	/* Detect and fix overflow. */
	if (ctx->count[0] < msglen)
		++ctx->count[1];

	if (msglen >= len) {

		/* Fill buffer to 64 bytes. */
		memcpy(ctx->buffer + n, msg, len);
		msglen -= len;
		msg += len;

		whirlpool_hash(ctx->state, ctx->buffer);

		/* Transform rest of the message. */
		while (msglen >= 64) {
			whirlpool_hash(ctx->state, msg);
			msg += 64;
			msglen -= 64;
		}

		n = 0;
	}

	/* Save message bytes to buffer if any left unprocessed. */
	memcpy(ctx->buffer+n, msg, msglen);
}

/* converts n 32-bit words to bytes (MSB first) */
static void
uint32_to_bytes(unsigned char *out, const u_int32_t *in, unsigned int n)
{
	unsigned int x, y;

	for (x = y = 0; y < n; y++) {
		out[x++] = (in[y] >> 24) & 0xff;
		out[x++] = (in[y] >> 16) & 0xff;
		out[x++] = (in[y] >> 8) & 0xff;
		out[x++] = in[y] & 0xff;
	}
}

void
whirlpool_final(struct whirlpool_context *ctx, unsigned char digest[64])
{
	static const unsigned char pad[64] = { 0x80, 0x0 };
	unsigned int n, npad;
	uint32_t nbits[3];
	uint8_t nb[32];

	n = ctx->count[0] & 0x3f;
	npad = ((n < 32) ? 32: 96) - n; 

	nbits[0] = ctx->count[1] >> 29;
	nbits[1] = ctx->count[1] << 3;
	nbits[1] += ctx->count[0] >> 29;
	nbits[2] = ctx->count[0] << 3;

	memset(nb, 0, sizeof(nb));
	/* Calculate length before padding. */
	uint32_to_bytes(nb+20, nbits, 3);

	/* Pad message and append length. */
	whirlpool_update(ctx, pad, npad);
	whirlpool_update(ctx, nb, 32);
	
	memcpy(digest, ctx->state, 64);
}

